<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0/dist/css/bootstrap.min.css" 
    rel="stylesheet" 
    integrity="sha384-wEmeIV1mKuiNpC+IOBjI7aAzPcEZeedi5yW5f2yOq55WWLwNGmvvx4Um1vskeMj0" 
    crossorigin="anonymous">
</head>

<%- include('partials/header.ejs') %>

<table class="admtable">
    <thead>
      <tr>
        <th>ID</th>
        <th>Name</th>
        <th>Username</th>
        <th>Password</th>
        <th>Email</th>
        <th>Role</th>
        <th>EDIT</th>
        <th>DELETE</th>
      </tr>
    </thead>
    

      <!-- <?php

        //Create the query for the admin table.
        $query = "SELECT * FROM users";
        $query_run = mysqli_query($conn, $query);

        //Check if there are any results for the query
        if (mysqli_num_rows($query_run) > 0) {

          //For every row of the resulted query create an html row with the user table data.
          while($row = mysqli_fetch_assoc($query_run) ){
          
    ?> -->
    <tbody>
        <tr>
            <td><?php echo $row["ID"]; ?></td>
            <td contenteditable="false"><?php echo $row["NAME"]; ?></td>
            <td contenteditable="false"><?php echo $row["SURNAME"]; ?></td>
            <td contenteditable="false"><?php echo $row["USERNAME"]; ?></td>
            <td><?php echo $row["PASSWORD"]; ?></td>
            <td contenteditable="false"><?php echo $row["EMAIL"]; ?></td>
            <td contenteditable="false"><?php echo $row["ROLE"]; ?></td>
            <td contenteditable="false"><?php echo $row["CONFIRMED"]; ?></td>
            <td> <button  type="submit" name="edit_btn" class="btn-edit">EDIT</button> </td>
            <td> <button id="<?= $row["ID"] ?>" type="submit" name="delete_btn" class="btn-delete">DELETE</button> </td>
        </tr>

    </tbody>

</table>


<script>

    $(document).ready(function () {
      //ajax for editing.
          $('.btn-edit').on('click', function () {
              var currentTD = $(this).parents('tr').find('td');
              var rowVal = [];
    
              if ($(this).html() == 'EDIT') {  
    
                $.each(currentTD, function () {
                  $(this).prop('contenteditable', true)
                });
    
              }else if ($(this).html() == 'SAVE'){
                $.each(currentTD, function () {
                  $(this).prop('contenteditable', false)
                  rowVal.push($(this).text());
                  //alert(rowVal);
                });
                //Change data in database
                $("#editStatus").html("");
                $("#editStatus").load("ajax_adminEdit.php", {
                  edit_id: rowVal[0],
                  edit_name: rowVal[1],
                  edit_surname: rowVal[2],
                  edit_username: rowVal[3],
                  edit_email: rowVal[5],
                  edit_role: rowVal[6],
                  edit_confirmed: rowVal[7],
                  updatebtn: rowVal[8]
                });
    
              }
    
              $(this).html($(this).html() == 'EDIT' ? 'SAVE' : 'EDIT')
    
          });
    
    
    
      //ajax for deleting.
        $('.btn-delete').on('click', function () {
    
    
              var btnname = $(this).text();
              var userid = $(this).attr('id');
              //alert(btnname + userid);
              $("#editStatus").html("");
              $(this).closest('tr').remove();
              $("#editStatus").load("ajax_adminDel.php", {
                delete_id: userid,
                delete_btn: btnname
              });
        });
    });
    
    
    </script>